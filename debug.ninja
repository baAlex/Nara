
cflags = `pkg-config --cflags glfw3 glesv2 portaudio-2.0` -O0 -std=c11 -Wall -Wextra -pedantic -g -DDEBUG -I./source/lib-japan/include
cflags_strict = `pkg-config --cflags glfw3 glesv2 portaudio-2.0` -O0 -std=c11 -Wall -Wextra -Wconversion -pedantic -g -DDEBUG -I./source/lib-japan/include
lflags = `pkg-config --libs glfw3 glesv2 portaudio-2.0` -lm

rule generate
 command = python3 ./tools/c-ify.py $in > $out

rule compile
 command = cc $cflags -c $in -o $out

rule compile_strict
 command = cc $cflags_strict -c $in -o $out

rule link
 command = cc $in $lflags -o $out


# Automatically generated files
build ./objects/debug/engine/terrain-fragment.c: generate ./source/engine/terrain-fragment.glsl
build ./objects/debug/engine/terrain-vertex.c:   generate ./source/engine/terrain-vertex.glsl
build ./objects/debug/engine/red-fragment.c:     generate ./source/engine/red-fragment.glsl
build ./objects/debug/engine/red-vertex.c:       generate ./source/engine/red-vertex.glsl

# Engine
build ./objects/debug/engine/context.o:          compile ./source/engine/context.c
build ./objects/debug/engine/context-input.o:    compile ./source/engine/context-input.c
build ./objects/debug/engine/timer.o:            compile ./source/engine/timer.c
build ./objects/debug/engine/misc.o:             compile_strict ./source/engine/misc.c
build ./objects/debug/engine/mixer.o:            compile_strict ./source/engine/mixer.c
build ./objects/debug/engine/tiny-gl.o:          compile_strict ./source/engine/tiny-gl.c
build ./objects/debug/engine/entity.o:           compile_strict ./source/engine/entity.c
build ./objects/debug/engine/nterrain.o:         compile_strict ./source/engine/nterrain.c
build ./objects/debug/engine/terrain-fragment.o: compile_strict ./objects/debug/engine/terrain-fragment.c
build ./objects/debug/engine/terrain-vertex.o:   compile_strict ./objects/debug/engine/terrain-vertex.c
build ./objects/debug/engine/red-fragment.o:     compile_strict ./objects/debug/engine/red-fragment.c
build ./objects/debug/engine/red-vertex.o:       compile_strict ./objects/debug/engine/red-vertex.c

# Game
build ./objects/debug/game/nara.o:   compile        ./source/game/nara.c
build ./objects/debug/game/camera.o: compile_strict ./source/game/camera.c
build ./objects/debug/game/point.o:  compile_strict ./source/game/point.c

# Lib Japan
build ./objects/debug/lib-japan/buffer.o:           compile_strict ./source/lib-japan/source/buffer.c
build ./objects/debug/lib-japan/dictionary.o:       compile_strict ./source/lib-japan/source/dictionary.c
build ./objects/debug/lib-japan/endianness.o:       compile_strict ./source/lib-japan/source/endianness.c
build ./objects/debug/lib-japan/list.o:             compile_strict ./source/lib-japan/source/list.c
build ./objects/debug/lib-japan/matrix.o:           compile_strict ./source/lib-japan/source/matrix.c
build ./objects/debug/lib-japan/status.o:           compile_strict ./source/lib-japan/source/status.c
build ./objects/debug/lib-japan/tree.o:             compile_strict ./source/lib-japan/source/tree.c
build ./objects/debug/lib-japan/vector.o:           compile_strict ./source/lib-japan/source/vector.c
build ./objects/debug/lib-japan/image/image.o:      compile_strict ./source/lib-japan/source/image/image.c
build ./objects/debug/lib-japan/image/format-sgi.o: compile_strict ./source/lib-japan/source/image/format-sgi.c
build ./objects/debug/lib-japan/sound/sound.o:      compile_strict ./source/lib-japan/source/sound/sound.c
build ./objects/debug/lib-japan/sound/format-au.o:  compile_strict ./source/lib-japan/source/sound/format-au.c
build ./objects/debug/lib-japan/sound/format-wav.o: compile_strict ./source/lib-japan/source/sound/format-wav.c
build ./objects/debug/lib-japan/sound/laws.o:       compile_strict ./source/lib-japan/source/sound/laws.c

# Sdk
build ./objects/debug/sdk/sdk.o: compile ./source/sdk/sdk.c

# Link
build nara-dbg: link $
./objects/debug/engine/context.o $
./objects/debug/engine/context-input.o $
./objects/debug/engine/timer.o $
./objects/debug/engine/misc.o $
./objects/debug/engine/mixer.o $
./objects/debug/engine/tiny-gl.o $
./objects/debug/engine/entity.o $
./objects/debug/engine/nterrain.o $
./objects/debug/engine/terrain-fragment.o $
./objects/debug/engine/terrain-vertex.o $
./objects/debug/engine/red-fragment.o $
./objects/debug/engine/red-vertex.o $
./objects/debug/game/nara.o $
./objects/debug/game/camera.o $
./objects/debug/game/point.o $
./objects/debug/lib-japan/buffer.o $
./objects/debug/lib-japan/dictionary.o $
./objects/debug/lib-japan/endianness.o $
./objects/debug/lib-japan/list.o $
./objects/debug/lib-japan/matrix.o $
./objects/debug/lib-japan/status.o $
./objects/debug/lib-japan/tree.o $
./objects/debug/lib-japan/vector.o $
./objects/debug/lib-japan/image/image.o $
./objects/debug/lib-japan/image/format-sgi.o $
./objects/debug/lib-japan/sound/sound.o $
./objects/debug/lib-japan/sound/format-au.o $
./objects/debug/lib-japan/sound/format-wav.o $
./objects/debug/lib-japan/sound/laws.o

build sdk-dbg: link $
./objects/debug/sdk/sdk.o $
./objects/debug/lib-japan/buffer.o $
./objects/debug/lib-japan/dictionary.o $
./objects/debug/lib-japan/endianness.o $
./objects/debug/lib-japan/list.o $
./objects/debug/lib-japan/matrix.o $
./objects/debug/lib-japan/status.o $
./objects/debug/lib-japan/tree.o $
./objects/debug/lib-japan/vector.o $
./objects/debug/lib-japan/image/image.o $
./objects/debug/lib-japan/image/format-sgi.o $
./objects/debug/lib-japan/sound/sound.o $
./objects/debug/lib-japan/sound/format-au.o $
./objects/debug/lib-japan/sound/format-wav.o $
./objects/debug/lib-japan/sound/laws.o
